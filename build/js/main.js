"use strict";$.ajax("../json/data.json",{method:"GET",dataType:"text",contentType:"application/json"}).done(function(t){var e=$.parseJSON(t),a=dataClosure(e);lsControl.getStore()?(dataClosure(lsControl.getStore()),console.log("loading from storage")):(lsControl.setStore(a),console.log("saving to storage")),renderTasks()});var renderTask=function(t){var e=dataClosure();$(createUpperPart(t)).append(createLowerPart(t,e))},renderTasks=function(){$("#wrap").html(""),dataClosure().tasks.forEach(function(t){console.log(t),console.log("params");var e=new Task(t.title,t.taskBody,t.status,t.priority,t.taskId);renderTask(e)});var t=$(".controls-bottom-wrap").remove(),e=createElement("<div></div>","Add new task","controls addnew",null,{click:saveAndModify},null);$(t).append(e),$(createElement("<div></div>",null,"controls-bottom-wrap",null,null,$("body"))).append(e)},lsControl={getStore:function(){return JSON.parse(localStorage.getItem("storage"))},setStore:function(t){localStorage.setItem("storage",JSON.stringify(t))}},storageMethods={deleteItem:function(e){var t=this.tasks.findIndex(function(t){return t.taskId===e});this.tasks.splice(t,1)},modifyItem:function(e,t){var a=this.tasks.find(function(t){return t.taskId.toString()===e.toString()});Object.assign(a,t),lsControl.setStore(dataClosure())}},dataClosure=function(){var e=Object.create(storageMethods);return function(t){return t&&Object.assign(e,t),e}}(),createUpperPart=function(t){var e=createElement("<div></div>",null,"task",null,null,"#wrap");return createElement("<div></div>",null,"remove",{"data-taskId":t.taskId},{click:removeTask},e).html("&times;"),createElement("<input>",null,"task-header edit-field disabled",{type:"text",id:"th-".concat(t.taskId),placeholder:t.title||"change title",value:t.title||"change title","data-edit-header":t.taskId},{blur:commitFieldChanges,keypress:keyCommit,click:editField},e),createElement("<input>",null,"task-body edit-field disabled",{type:"text",id:"tb-".concat(t.taskId),placeholder:t.taskBody||"change body",value:t.taskBody||"change body","data-edit-body":t.taskId},{blur:commitFieldChanges,keypress:keyCommit,click:editField},e),e},createLowerPart=function(t,e){console.log("checking id"),console.log(t.id);var a=$(createElement("<div></div>",null,"status-wrap",null,null,null));$(a).html(""),createElement("<div></div>",t.status,"status open",null,null,a);var s=createElement("<select></select>",null,"status-change",{id:"s-".concat(t.taskId)},null,a);e.status.forEach(function(t,e){createElement("<option></option>",t,null,{value:e},null,s)}),createElement("<div></div>",null,"break",null,null,a),createElement("<div></div>","Priority: ".concat(t.priority),"priority",null,null,a);var o=createElement("<select></select>",null,"priority-change",{id:"p-".concat(t.taskId)},null,a);return e.priorities.forEach(function(t,e){createElement("<option></option>",t,null,{value:e},null,o)}),createElement("<div></div>","SAVE","controls save",{"data-item-id":t.taskId},{click:saveAndModify},a),a},createElement=function(t,e,a,s,o,n){var l=s||{};l.text=e,l.class=a;var r=$(t,l);for(var i in o)o.hasOwnProperty(i)&&$(r)[i](o[i]);return n&&$(n).append(r),r},updateOrModifyTask=function(t,e){var a=t.dataset.itemId;console.log(a);var s={title:$("#th-".concat(a)).val(),taskBody:$("#tb-".concat(a)).val(),status:parseInt($("#s-".concat(a)).val()),priority:parseInt($("#p-".concat(a)).val())};if(console.log(s),e)console.log(t),dataClosure().modifyItem(a,s),renderTasks();else{var o=new Task("Enter task name","Enter task body",0,0,dataClosure().tasks.length+1);dataClosure().tasks.push(o),lsControl.setStore(dataClosure()),renderTasks()}};function saveAndModify(){console.log(this.dataset),this.parentNode.classList.contains("controls-bottom-wrap")?updateOrModifyTask(this,!1):updateOrModifyTask(this,!0)}function removeTask(){var t=this.dataset.taskid;dataClosure().deleteItem(t),lsControl.setStore(dataClosure()),renderTasks()}function editField(){$(this).removeClass("disabled")}function commitFieldChanges(){$(this).addClass("disabled")}function keyCommit(t){13===t.keyCode&&(commitFieldChanges.call(this),$(this).blur())}function Task(t,e,a,s,o){this.title=t,this.taskBody=e,this.status=dataClosure().status[a]||dataClosure().status[0],this.priority=dataClosure().priorities[s]||dataClosure().priorities[0],this.taskId=o}